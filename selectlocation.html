<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Baltic Comfort</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body class="hero">
    <div class="booking-header">
        <h1>Baltic Comfort</h1>
        <p>Empowering hotel businesses with secure blockchain payments</p>
    </div>
    <div class="booking-container">
        <h2>Start Your Booking</h2>

        <form id="bookingForm" class="booking-form-row" onsubmit="return false;">
            <div class="form-inline">
                <label for="country"><b>Select Country:</b></label>
                <select id="country" name="country">
                    <option value="">-- Select Country --</option>
                    <option value="denmark">Denmark</option>
                    <option value="estonia">Estonia</option>
                    <option value="latvia">Latvia</option>
                    <option value="lithuania">Lithuania</option>
                </select>
            </div>
            <div class="form-inline">
                <label for="city"><b>Select City/Town:</b></label>
                <select id="city" name="city" disabled>
                    <option value="">-- Select City/Town --</option>
                </select>
            </div>
        </form>

        <!-- Added: live location display inside the page so the chosen location shows immediately -->
        <p id="selectedLocation" aria-live="polite"></p>
    </div>

    <button id="continueBtn" class="btn continue-btn">Continue</button>

    <script>
        const cities = {
            denmark: ["Copenhagen", "Aarhus", "Odense", "Aalborg", "Esbjerg"],
            estonia: ["Tallinn", "Tartu", "Narva", "Pärnu", "Viljandi"],
            latvia: ["Riga", "Daugavpils", "Liepaja", "Jelgava", "Jurmala"],
            lithuania: ["Vilnius", "Kaunas", "Klaipeda", "Šiauliai", "Panevėžys"]
        };

        const countrySelect = document.getElementById('country');
        const citySelect = document.getElementById('city');
        const continueBtn = document.getElementById('continueBtn');
        const selectedLocation = document.getElementById('selectedLocation');

        function updateLocationDisplay() {
            const countryIndex = countrySelect.selectedIndex;
            const countryText = countryIndex >= 0 ? countrySelect.options[countryIndex].text : '';
            const cityIndex = citySelect.selectedIndex;
            const cityText = cityIndex >= 0 ? citySelect.options[cityIndex].text : '';

            if (countrySelect.value && citySelect.value) {
                selectedLocation.textContent = `Selected location: ${countryText} — ${cityText}`;
            } else if (countrySelect.value) {
                selectedLocation.textContent = `Selected country: ${countryText} (please select a city/town)`;
            } else {
                selectedLocation.textContent = '';
            }
        }

        // helper: slugify (keeps diacritics but encodes later when building the URL)
        function slugifyCity(name) {
            return name.toLowerCase().replace(/\s+/g, '-').replace(/[''\"]/g, '');
        }

        // Populate city list when country changes and update display
        countrySelect.addEventListener('change', function() {
            const selectedCountry = this.value;
            citySelect.innerHTML = '<option value="">-- Select City/Town --</option>';
            citySelect.disabled = !selectedCountry;
            if (cities[selectedCountry]) {
                cities[selectedCountry].forEach(function(city) {
                    const opt = document.createElement('option');
                    opt.value = slugifyCity(city); // e.g., "aarhus", "pärnu" -> "pärnu"
                    opt.text = city;
                    citySelect.appendChild(opt);
                });
            }
            // Update display after repopulating cities
            updateLocationDisplay();
        });

        // Update display when city selection changes
        citySelect.addEventListener('change', updateLocationDisplay);

        // Build the expected path for a city page:
        // html/cities/<country>/<city>.html
        function buildCityPath(country, citySlug) {
            // encode each segment to be safe with special characters
            const segments = ['html', 'cities', country, citySlug + '.html'];
            return segments.map(encodeURIComponent).join('/');
        }

        // Check URL existence with a quick HEAD request before navigating.
        // If HEAD is not allowed by the host, fall back to a GET check.
        async function checkUrlExists(url) {
            try {
                let resp = await fetch(url, { method: 'HEAD' });
                if (resp && resp.ok) return true;
                // If HEAD returned non-ok, try GET (some hosts don't support HEAD)
                resp = await fetch(url, { method: 'GET' });
                return resp && resp.ok;
            } catch (err) {
                console.warn('Error while checking URL existence:', err);
                return false;
            }
        }

        // Continue button behaviour: build path and navigate only if the page exists
        continueBtn.addEventListener('click', async function() {
            const selectedCountry = countrySelect.value;
            const selectedCity = citySelect.value;
            if (!selectedCountry) {
                alert('Please select a country before continuing.');
                return;
            }
            if (!selectedCity) {
                alert('Please select a city/town before continuing.');
                return;
            }

            const path = buildCityPath(selectedCountry, selectedCity);

            // Try to check the page first so user doesn't hit a raw 404
            continueBtn.disabled = true;
            continueBtn.textContent = 'Checking…';
            const exists = await checkUrlExists(path);
            continueBtn.disabled = false;
            continueBtn.textContent = 'Continue';

            if (exists) {
                window.location.href = path;
            } else {
                // Friendly message and hint for you as repo owner
                alert('Sorry — the selected city page was not found on the site.\n\n' +
                      'Expected path: ' + path + '\n\n' +
                      'If you want this city available, add the file at the above location (for example: html/cities/' + selectedCountry + '/' + selectedCity + '.html).');
            }
        });

        // Initialize display on load (in case the selects are pre-filled)
        document.addEventListener('DOMContentLoaded', function() {
            updateLocationDisplay();
        });
    </script>
</body>
</html>
